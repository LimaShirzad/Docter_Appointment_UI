<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Specialty</title>
         <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    

</head>
<body>

         <div id="sidebar_box"></div>
       
        <div class="main-content">
           
        <div id="header_box"></div>


    <div class="container mt-4">
        <div class="role_card">
            <div class="role_card-header">
                <h1>Update Role</h1>
            </div>
            
            <div class="card-body">
                <!-- <div class="medical-icon">
                    <i class="fas fa-heartbeat"></i>
                </div> -->
                
                <form id="updateRoleForm" >
                    <div class="form-group">
                          <input type="hidden" id="roleId">
                        <label for="Role">Role</label>
                        <div class="role_input-container">
                            <input 
                                type="text" 
                                id="role" 
                                placeholder="Enter Role Name " 
                                name="role"
                                
                               
                            >
                    

                            <span id="msg"  class="mt-3"
                            style="font-weight: bold; text-transform: capitalize; margin-top: 10px;"></span>
                        </div>

                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn submit-btn">
                            <i class="fas fa-plus-circle"></i> Update Role
                        </button>
                        <button type="button" 
                        class="btn cancel-btn" id="role_cancel_btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <p>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Id, maiores! Accusamus mollitia nisi odio ex ipsam velit sequi distinctio aspernatur delectus a neque, adipisci explicabo sit molestiae sed ut? Veritatis, magnam ducimus! Nihil qui eos explicabo, ducimus totam rem ullam id aliquam? Laborum inventore tempora eligendi dolorem ab commodi, quo officia ratione in et, cupiditate sit rerum quam illum adipisci.
        </p>


<div id="msg_box" class="card"></div>
 

<script src="assets/js/comman.js"></script>
<script src="assets/js/dashbord.js"></script>
<script src="assets/js/app.js"></script>

<!-- <script>
// 1. Get role ID from URL
const params = new URLSearchParams(window.location.search);
const roleId = params.get("id");

// 2. Get input fields
const roleInput = document.getElementById("role");
const roleIdInput = document.getElementById("roleId");

// 3. Load existing role from backend
fetch("http://localhost:8080/api/roles/" + roleId)
    .then(res => res.json())
    .then(data => {
        roleInput.value = data.role;    // show role name
        roleIdInput.value = data.id;    // store role ID
    })
    .catch(err => alert("Error loading role"));

// 4. Update role when form is submitted
document.getElementById("updateRoleForm").addEventListener("submit", function(e) {
    e.preventDefault();

    fetch("http://localhost:8080/api/roles/" + roleId, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ role: roleInput.value })
    })
    .then(res => {
        if (res.ok) {
            alert("Role updated!");
            window.location.href = "userRoles.html"; // back to table
        } else {
            alert("Update failed!");
        }
    });
});

// 5. Cancel button
document.getElementById("role_cancel_btn").addEventListener("click", function() {
    window.location.href = "userRoles.html";
});
</script> -->

<!-- <script>
document.getElementById("updateRoleForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const msg = document.getElementById("msg");

    fetch("http://localhost:8080/api/roles/" + roleId, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ role: roleInput.value })
    })
    .then(res => res.json().then(data => ({ ok: res.ok, data })))
    .then(res => {
        if (res.ok) {
            alert("Role updated!");
            window.location.href = "userRoles.html";
        } else {
            // show error from backend
            msg.innerText = res.data.errors?.role || res.data.message || "Update failed!";
            msg.style.color = "red";
        }
    })
    .catch(() => {
        msg.innerText = "Something went wrong!";
        msg.style.color = "red";
    });
});
</script> -->






<script>
document.addEventListener("DOMContentLoaded", async () => {

    const form = document.getElementById("updateRoleForm");
    const roleInput = document.getElementById("role");
    const roleIdInput = document.getElementById("roleId");
    const msg = document.getElementById("msg");
    const msgBox = document.getElementById("msg_box");

    // 1. Get role ID from URL
    const roleId = new URLSearchParams(window.location.search).get("id");

    if (!roleId) {
        msg.innerText = "No role ID provided!";
        msg.style.color = "red";
        return;
    }

    // 2. Load existing role and show in input
    try {
        const res = await fetch(`http://localhost:8080/api/roles/${roleId}`);
        if (!res.ok) throw new Error("Failed to load role");

        const data = await res.json();
        roleInput.value = data.role;   // show role name
        roleIdInput.value = data.id;   // store role ID (hidden)
    } catch {
        msg.innerText = "Error loading role!";
        msg.style.color = "red";
        return;
    }

    // 3. Handle form submit
    form.onsubmit = async e => {
        e.preventDefault();
        msg.innerText = "";
        msgBox.innerText = "";

        try {
            const res = await fetch(`http://localhost:8080/api/roles/${roleId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ role: roleInput.value })
            });

            const data = await res.json();

            if (!res.ok) {
                // Combine all possible error messages
                let errorMessage = "";
                if (data.errors) {
                    for (const field in data.errors) {
                        errorMessage += `${data.errors[field]} `;
                    }
                }
                if (data.message) {
                    errorMessage += data.message;
                }
                msg.innerText = errorMessage || "Update failed!";
                msg.style.color = "red";
            } else {
                msgBox.innerText = "Role Updated Successfully!";
                msgBox.style.right = "0";
                setTimeout(() => {
                    msgBox.style.right = "-100%";
                    window.location.href = "userRoles.html";
                }, 3000);
            }

        } catch {
            msg.innerText = "Network error!";
            msg.style.color = "red";
        }
    };

    // 4. Cancel button
    document.getElementById("role_cancel_btn").onclick = () => {
        window.location.href = "userRoles.html";
    };

});
</script>


</body>
</html>