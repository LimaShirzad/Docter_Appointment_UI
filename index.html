package com.doctoreappointmentProject.doctoreappointmentProject.util;

// ğŸ§© Ø¯Ø§ imports Ø¯ JWT token Ø¬ÙˆÚ“ÙˆÙ„Ùˆ Ø§Ùˆ verify Ú©ÙˆÙ„Ùˆ Ù„Ù¾Ø§Ø±Ù‡ Ø¯ÙŠ
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;

import java.security.Key;
import java.util.Date;

public class JwtUtil {

    // ğŸ” Ø¯Ø§ ÛŒÙˆ secret key Ø¬ÙˆÚ“ÙˆÙŠ Ú†Û Ø¯ Token Ø¯ Ù„Ø§Ø³Ù„ÛŒÚ© (signature) Ù„Ù¾Ø§Ø±Ù‡ Ú©Ø§Ø±ÛÚ–ÙŠ.
    // Ø¯Ø§ Ú©Ù„ÛŒØ¯ (key) Ø¯ HS256 Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù„Ù¾Ø§Ø±Ù‡ ØªÙˆÙ„ÛŒØ¯ÛŒÚ–ÙŠ.
    private static final Key key = Keys.secretKeyFor(SignatureAlgorithm.HS256);

    // â° Ø¯Ø§ Ø¯ Token Ø¯ Ø§Ø¹ØªØ¨Ø§Ø± ÙˆØ®Øª Ø¯ÛŒ (Expiration time) â€” 1 Ø³Ø§Ø¹Øª = 3600000 milliseconds.
    private static final long EXPIRATION_TIME = 1000 * 60 * 60; // (1 hour)


    // ğŸ”§ Ø¯Ø§ function Ø¯ JWT Token Ø¬ÙˆÚ“ÙˆÙŠ.
    // username, id, Ø§Ùˆ role Ø¯ user Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯ÙŠ Ú†Û token Ú©Û Ø´Ø§Ù…Ù„ÛÚ–ÙŠ.
    public static String generateToken(String username, Long id, String role) {

        // ğŸ§± Ø¯Ù„ØªÙ‡ ÛŒÙˆ Ù†ÙˆÛŒ JWT Ø¬ÙˆÚ“ÙˆÙˆ
        return Jwts.builder()
                // ğŸ‘¤ Subject Ø¯Ø§ Ø¯ user Ø§ØµÙ„ÙŠ identity Ø¯Ù‡ â€” Ø¹Ù…ÙˆÙ…Ø§Ù‹ username.
                .setSubject(username)

                // ğŸ§¾ Ø¯Ø§ claim Ø§Ø¶Ø§ÙÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯ÙŠ Ú†Û token Ú©Û ÙˆØ±Ø³Ø±Ù‡ Ø³Ø§ØªÙˆ.
                .claim("role", role)  // Ø¯ user Ø±ÙˆÙ„ (Ù…Ø«Ù„Ø§Ù‹ "ADMIN" ÛŒØ§ "PATIENT")
                .claim("id", id)      // Ø¯ user ID

                // ğŸ•’ Ø¯Ø§ ÙˆØ®Øª ÚšÙŠÙŠ Ú†Û Token Ú©Ù„Ù‡ Ø¬ÙˆÚ“ Ø´Ùˆ.
                .setIssuedAt(new Date(System.currentTimeMillis()))

                // â³ Ø¯Ø§ ÙˆØ®Øª ÚšÙŠÙŠ Ú†Û Token Ø¨Ù‡ Ú©Ù„Ù‡ Ø®ØªÙ… Ø´ÙŠ.
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))

                // âœï¸ Ø¯Ù„ØªÙ‡ Ù…ÙˆÚ– Token Ø¯ Ø®Ù¾Ù„ secret key Ù¾Ù‡ ÙˆØ³ÛŒÙ„Ù‡ Ù„Ø§Ø³Ù„ÛŒÚ© Ú©ÙˆÙˆ
                .signWith(key)

                // ğŸ¯ Token Ø¬ÙˆÚ“ Ø´Ùˆ â€” Ø¯Ø§ method Ù‡ØºÙ‡ Ø¯ string Ù¾Ù‡ Ø¨Ú¼Ù‡ Ø±Ø§Ú«Ø±ÚÙˆÙŠ.
                .compact();
    }


    // ğŸ” Ø¯Ø§ function Ù„Ù‡ Token Ú…Ø®Ù‡ username Ø¨ÛØ±ØªÙ‡ Ø±Ø§ÙˆØ¨Ø§Ø³ÙŠ.
    public static String getUserNameFromToken(String token) {

        // ğŸ§© Ø¯Ù„ØªÙ‡ Ù…ÙˆÚ– token verify Ú©ÙˆÙˆ Ø§Ùˆ Ù¼ÙˆÙ„ claims (Ù…Ø¹Ù„ÙˆÙ…Ø§Øª) ØªØ±Û Ø§Ø®Ù„Ùˆ
        return Jwts.parser()
                .setSigningKey(key) // Ù‡Ù…Ø§ØºÙ‡ key Ú†Û Ø¯ sign Ú©ÙˆÙ„Ùˆ Ù„Ù¾Ø§Ø±Ù‡ Ú©Ø§Ø±ÛØ¯Ù„ÛŒ
                .parseClaimsJws(token) // token ØªØ¬Ø²ÛŒÙ‡ Ú©ÙˆÙŠ
                .getBody() // Ø¯ token Ø§ØµÙ„ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                .getSubject();  // âœ… Ù„Ù‡ Body Ù†Ù‡ ÛŒÙˆØ§Ø²Û username Ø§Ø®Ù„Ùˆ
    }


    // ğŸ” Ø¯Ø§ function Ù„Ù‡ Token Ú…Ø®Ù‡ Ø¯ role (Ø±ÙˆÙ„) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø±Ø§ÙˆØ¨Ø§Ø³ÙŠ.
    public static String getRoleFromToken(String token) {

        // ğŸ¯ Ø¯Ø§ parser Ø¯ token verify Ú©ÙˆÙŠ Ø§Ùˆ Ù„Ù‡ body Ú…Ø®Ù‡ Ø¯ "role" claim Ø§Ø®Ù„ÙŠ.
        return (String) Jwts.parser()
                .setSigningKey(key)
                .parseClaimsJws(token)
                .getBody()
                .get("role"); // role field Ø±Ø§ÙˆØ¨Ø§Ø³ÙŠ
    }
}




