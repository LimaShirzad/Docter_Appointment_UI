package com.doctoreappointmentProject.doctoreappointmentProject.util;

// 🧩 دا imports د JWT token جوړولو او verify کولو لپاره دي
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;

import java.security.Key;
import java.util.Date;

public class JwtUtil {

    // 🔐 دا یو secret key جوړوي چې د Token د لاسلیک (signature) لپاره کارېږي.
    // دا کلید (key) د HS256 الگوریتم لپاره تولیدیږي.
    private static final Key key = Keys.secretKeyFor(SignatureAlgorithm.HS256);

    // ⏰ دا د Token د اعتبار وخت دی (Expiration time) — 1 ساعت = 3600000 milliseconds.
    private static final long EXPIRATION_TIME = 1000 * 60 * 60; // (1 hour)


    // 🔧 دا function د JWT Token جوړوي.
    // username, id, او role د user معلومات دي چې token کې شاملېږي.
    public static String generateToken(String username, Long id, String role) {

        // 🧱 دلته یو نوی JWT جوړوو
        return Jwts.builder()
                // 👤 Subject دا د user اصلي identity ده — عموماً username.
                .setSubject(username)

                // 🧾 دا claim اضافي معلومات دي چې token کې ورسره ساتو.
                .claim("role", role)  // د user رول (مثلاً "ADMIN" یا "PATIENT")
                .claim("id", id)      // د user ID

                // 🕒 دا وخت ښيي چې Token کله جوړ شو.
                .setIssuedAt(new Date(System.currentTimeMillis()))

                // ⏳ دا وخت ښيي چې Token به کله ختم شي.
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))

                // ✍️ دلته موږ Token د خپل secret key په وسیله لاسلیک کوو
                .signWith(key)

                // 🎯 Token جوړ شو — دا method هغه د string په بڼه راګرځوي.
                .compact();
    }


    // 🔍 دا function له Token څخه username بېرته راوباسي.
    public static String getUserNameFromToken(String token) {

        // 🧩 دلته موږ token verify کوو او ټول claims (معلومات) ترې اخلو
        return Jwts.parser()
                .setSigningKey(key) // هماغه key چې د sign کولو لپاره کارېدلی
                .parseClaimsJws(token) // token تجزیه کوي
                .getBody() // د token اصلي معلومات
                .getSubject();  // ✅ له Body نه یوازې username اخلو
    }


    // 🔍 دا function له Token څخه د role (رول) معلومات راوباسي.
    public static String getRoleFromToken(String token) {

        // 🎯 دا parser د token verify کوي او له body څخه د "role" claim اخلي.
        return (String) Jwts.parser()
                .setSigningKey(key)
                .parseClaimsJws(token)
                .getBody()
                .get("role"); // role field راوباسي
    }
}




